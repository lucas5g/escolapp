#!/bin/bash

generateDatabase(){
  if [ "$1" == "gd" ]; then 
    source .env
    #Exportar banco
    docker exec laradock_mysql_1 sh -c 'exec mysqldump -u root -proot jisa-express' > jisa-express.sql

    #Importar banco na clever cloud
    docker exec -i laradock_mysql_1 sh -c "mysql -h $MYSQL_HOST -u $MYSQL_USER -p$MYSQL_PASSWORD $MYSQL_DATABASE" < jisa-express.sql


    exit 0
  fi
}

update(){
  if [ "$1" == "update" ]; then
    start=`date +%s`
    git add .
    git commit -m "$2"
    git push
    ssh -t root@test.codificar.dev.br "\
      cd projects/jisa \
      && git pull \
      && source ~/.nvm/nvm.sh \
      && cd server \
      && npm i \
      && npm run build \
      && pm2 restart jisa --update-env
    "

    echo -e "\nhttps://test.codificar.dev.br \n"

    end=`date +%s`
    runtime=$((end-start))

    echo -e "Tempo de deploy $runtime.\n"
    exit 0
  fi
}

  # && cd server \
command=$1
message=$2

main(){

  generateDatabase $command
  update $command "$message"
  echo -e "\nComando nÃ£o encontrado :(\n"

  echo $runtime

}

main